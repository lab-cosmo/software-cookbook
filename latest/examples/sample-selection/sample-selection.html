<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Training the DOS with different Energy References" href="../dos-align/dos-align.html" /><link rel="prev" title="PCA/PCovR Visualization for the rattled GaAs training dataset" href="../gaas-map/gaas-map.html" />

    <!-- Generated with Sphinx 7.3.7 and Furo 2024.05.06 -->
        <title>Sample and Feature Selection with FPS and CUR - cosmo-software-cookbook documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=387cc868" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" /
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">cosmo-software-cookbook  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">cosmo-software-cookbook  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../gaas-map/gaas-map.html">PCA/PCovR Visualization for the rattled GaAs training dataset</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Sample and Feature Selection with FPS and CUR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dos-align/dos-align.html">Training the DOS with different Energy References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lpr/lpr.html">LPR analysis for amorphous silicon dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roy-gch/roy-gch.html">Generalized Convex Hull construction for the polymorphs of ROY</a></li>
<li class="toctree-l1"><a class="reference internal" href="../batch-cp2k/reference-trajectory.html">Batch run of CP2K calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lode-linear/lode-linear.html">LODE Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../path-integrals/path-integrals.html">Path integral molecular dynamics</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../_sources/examples/sample-selection/sample-selection.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-sample-selection-sample-selection-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="sample-and-feature-selection-with-fps-and-cur">
<span id="sphx-glr-examples-sample-selection-sample-selection-py"></span><h1>Sample and Feature Selection with FPS and CUR<a class="headerlink" href="#sample-and-feature-selection-with-fps-and-cur" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Authors<span class="colon">:</span></dt>
<dd class="field-odd"><p>Davide Tisi <a class="reference external" href="https://github.com/DavideTisi">&#64;DavideTisi</a></p>
</dd>
</dl>
<p>In this tutorial we generate descriptors using rascaline, then select a subset
of structures using both the farthest-point sampling (FPS) and CUR algorithms
implemented in scikit-matter. Finally, we also generate a selection of
the most important features using the same techniques.</p>
<p>First, import all the necessary packages</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ase.io</span>
<span class="kn">import</span> <span class="nn">chemiscope</span>
<span class="kn">import</span> <span class="nn">metatensor</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">equisolve.numpy</span> <span class="kn">import</span> <span class="n">feature_selection</span><span class="p">,</span> <span class="n">sample_selection</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">rascaline</span> <span class="kn">import</span> <span class="n">SoapPowerSpectrum</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">skmatter</span> <span class="kn">import</span> <span class="n">feature_selection</span> <span class="k">as</span> <span class="n">skfeat_selection</span>
</pre></div>
</div>
<section id="load-molecular-data">
<h2>Load molecular data<a class="headerlink" href="#load-molecular-data" title="Link to this heading">¶</a></h2>
<p>Load 500 example BTO structures from file, reading them using
<a class="reference external" href="https://wiki.fysik.dtu.dk/ase/">ASE</a>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load a subset of :download:`structures &lt;input-fps.xyz&gt;` of the example dataset</span>
<span class="n">n_frames</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">frames</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;input-fps.xyz&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">n_frames</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;extxyz&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="compute-soap-descriptors-using-rascaline">
<h2>Compute SOAP descriptors using rascaline<a class="headerlink" href="#compute-soap-descriptors-using-rascaline" title="Link to this heading">¶</a></h2>
<p>First, define the rascaline hyperparameters used to compute SOAP.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># rascaline hyperparameters</span>
<span class="n">hypers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;cutoff&quot;</span><span class="p">:</span> <span class="mf">6.0</span><span class="p">,</span>
    <span class="s2">&quot;max_radial&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s2">&quot;max_angular&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s2">&quot;atomic_gaussian_width&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
    <span class="s2">&quot;cutoff_function&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ShiftedCosine&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}},</span>
    <span class="s2">&quot;radial_basis&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Gto&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">}},</span>
    <span class="s2">&quot;radial_scaling&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Willatt2018&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;exponent&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="mf">3.5</span><span class="p">}},</span>
    <span class="s2">&quot;center_atom_weight&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Generate a SOAP power spectrum</span>
<span class="n">calculator</span> <span class="o">=</span> <span class="n">SoapPowerSpectrum</span><span class="p">(</span><span class="o">**</span><span class="n">hypers</span><span class="p">)</span>
<span class="n">rho2i</span> <span class="o">=</span> <span class="n">calculator</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>


<span class="c1"># Makes a dense block</span>
<span class="n">atom_soap</span> <span class="o">=</span> <span class="n">rho2i</span><span class="o">.</span><span class="n">keys_to_properties</span><span class="p">([</span><span class="s2">&quot;species_neighbor_1&quot;</span><span class="p">,</span> <span class="s2">&quot;species_neighbor_2&quot;</span><span class="p">])</span>

<span class="n">atom_soap_single_block</span> <span class="o">=</span> <span class="n">atom_soap</span><span class="o">.</span><span class="n">keys_to_samples</span><span class="p">(</span><span class="n">keys_to_move</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;species_center&quot;</span><span class="p">])</span>

<span class="c1"># Sum over atomic centers to compute structure features</span>
<span class="n">struct_soap</span> <span class="o">=</span> <span class="n">metatensor</span><span class="o">.</span><span class="n">sum_over_samples</span><span class="p">(</span>
    <span class="n">atom_soap_single_block</span><span class="p">,</span> <span class="n">sample_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="s2">&quot;species_center&quot;</span><span class="p">]</span>
<span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;atom feature descriptor shape:&quot;</span><span class="p">,</span> <span class="n">atom_soap</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;atom feature descriptor (all in one block) shape:&quot;</span><span class="p">,</span>
    <span class="n">atom_soap_single_block</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;structure feature descriptor shape:&quot;</span><span class="p">,</span> <span class="n">struct_soap</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>atom feature descriptor shape: (12000, 2688)
atom feature descriptor (all in one block) shape: (20000, 2688)
structure feature descriptor shape: (500, 2688)
</pre></div>
</div>
</section>
<section id="perform-atomic-environment-i-e-sample-selection">
<h2>Perform atomic environment (i.e. sample) selection<a class="headerlink" href="#perform-atomic-environment-i-e-sample-selection" title="Link to this heading">¶</a></h2>
<p>Using FPS and CUR algorithms, we can perform selection of atomic environments.
These are implemented in equisolve, which provides a wrapper around
scikit-matter to allow for interfacing with data stored in the metatensor
format.</p>
<p>Suppose we want to select the 10 most diverse environments for each chemical
species.</p>
<p>First, we can use the <cite>keys_to_properties</cite> operation in metatensor to move the
neighbour species indices to the properties of the TensorBlocks. The resulting
descriptor will be a TensorMap comprised of three blocks, one for each
chemical species, where the chemical species indices are solely present in the
keys.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----Atomic environment selection-----&quot;</span><span class="p">)</span>
<span class="c1"># Define the number of structures to select using FPS/CUR</span>
<span class="n">n_envs</span> <span class="o">=</span> <span class="mi">25</span>

<span class="nb">print</span><span class="p">(</span><span class="n">atom_soap</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">atom_soap</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>----Atomic environment selection-----
TensorMap with 3 blocks
keys: species_center
            8
            22
            56
TensorBlock
    samples (12000): [&#39;structure&#39;, &#39;center&#39;]
    components (): []
    properties (2688): [&#39;species_neighbor_1&#39;, &#39;species_neighbor_2&#39;, &#39;l&#39;, &#39;n1&#39;, &#39;n2&#39;]
    gradients: None
</pre></div>
</div>
<p>select 10 atomic environments for each chemical species.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the number of structures *per block* to select using FPS</span>
<span class="n">n_envs</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># FPS sample selection</span>
<span class="n">selector_atomic_fps</span> <span class="o">=</span> <span class="n">sample_selection</span><span class="o">.</span><span class="n">FPS</span><span class="p">(</span><span class="n">n_to_select</span><span class="o">=</span><span class="n">n_envs</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">atom_soap</span>
<span class="p">)</span>

<span class="c1"># Print the selected envs for each block</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;atomic envs selected with FPS:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">selector_atomic_fps</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;species_center:&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">(struct_idx, atom_idx)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">block</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="n">selector_atomic_cur</span> <span class="o">=</span> <span class="n">sample_selection</span><span class="o">.</span><span class="n">CUR</span><span class="p">(</span><span class="n">n_to_select</span><span class="o">=</span><span class="n">n_envs</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">atom_soap</span><span class="p">)</span>
<span class="c1"># Print the selected envs for each block</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;atomic envs selected with CUR:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">selector_atomic_cur</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;species_center:&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">(struct_idx, atom_idx)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">block</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>atomic envs selected with FPS:

species_center: LabelsEntry(species_center=8)
(struct_idx, atom_idx)
 [[ 68  18]
 [113  36]
 [140  21]
 [285  20]
 [339  16]
 [339  23]
 [339  24]
 [341  17]
 [347  37]
 [436  22]]
species_center: LabelsEntry(species_center=22)
(struct_idx, atom_idx)
 [[ 19   8]
 [ 55  13]
 [166  15]
 [198  12]
 [216   8]
 [285   9]
 [324   8]
 [341  12]
 [433  13]
 [466   9]]
species_center: LabelsEntry(species_center=56)
(struct_idx, atom_idx)
 [[ 40   7]
 [140   2]
 [238   3]
 [289   6]
 [339   3]
 [341   4]
 [407   0]
 [407   7]
 [436   6]
 [451   7]]
atomic envs selected with CUR:

species_center: LabelsEntry(species_center=8)
(struct_idx, atom_idx)
 [[ 55  21]
 [ 68  20]
 [ 77  30]
 [198  36]
 [267  32]
 [336  33]
 [339  24]
 [339  36]
 [341  17]
 [436  19]]
species_center: LabelsEntry(species_center=22)
(struct_idx, atom_idx)
 [[ 10  39]
 [ 40  10]
 [ 70  10]
 [130  10]
 [166  15]
 [170  14]
 [216   8]
 [285   9]
 [326  10]
 [466  10]]
species_center: LabelsEntry(species_center=56)
(struct_idx, atom_idx)
 [[ 40   7]
 [ 77   3]
 [172   3]
 [219   7]
 [289   6]
 [296   2]
 [339   5]
 [339   6]
 [407   0]
 [436   2]]
</pre></div>
</div>
</section>
<section id="selecting-from-a-combined-pool-of-atomic-environments">
<h2>Selecting from a combined pool of atomic environments<a class="headerlink" href="#selecting-from-a-combined-pool-of-atomic-environments" title="Link to this heading">¶</a></h2>
<p>One can also select from a combined pool of atomic environments and
structures, instead of selecting an equal number of atomic environments for
each chemical species. In this case, we can move the ‘species_center’ key to samples
such that our descriptor is a TensorMap consisting of a single block. Upon
sample selection, the most diverse atomic environments will be selected,
regardless of their chemical species.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----All atomic environment selection-----&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;keys&quot;</span><span class="p">,</span> <span class="n">atom_soap</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;blocks&quot;</span><span class="p">,</span> <span class="n">atom_soap</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;samples in first block&quot;</span><span class="p">,</span> <span class="n">atom_soap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">samples</span><span class="p">)</span>

<span class="c1"># Using the original SOAP descriptor, move all keys to properties.</span>


<span class="c1"># Define the number of structures to select using FPS</span>
<span class="n">n_envs</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># FPS sample selection</span>
<span class="n">selector_atomic_fps</span> <span class="o">=</span> <span class="n">sample_selection</span><span class="o">.</span><span class="n">FPS</span><span class="p">(</span><span class="n">n_to_select</span><span class="o">=</span><span class="n">n_envs</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">atom_soap_single_block</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;atomic envs selected with FPS: </span><span class="se">\n</span><span class="s2"> (struct_idx, atom_idx, species_center) </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">selector_atomic_fps</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>----All atomic environment selection-----
keys Labels(
    species_center
          8
          22
          56
)
blocks TensorBlock
    samples (12000): [&#39;structure&#39;, &#39;center&#39;]
    components (): []
    properties (2688): [&#39;species_neighbor_1&#39;, &#39;species_neighbor_2&#39;, &#39;l&#39;, &#39;n1&#39;, &#39;n2&#39;]
    gradients: None
samples in first block Labels(
    structure  center
        0        16
        0        17
          ...
       499       30
       499       31
)
atomic envs selected with FPS:
 (struct_idx, atom_idx, species_center)
 [[ 68  12  22]
 [ 77  30   8]
 [140  21   8]
 [166  15  22]
 [216   8  22]
 [289   6  56]
 [339  18   8]
 [407   0  56]
 [460   4  56]
 [466  34   8]]
</pre></div>
</div>
</section>
<section id="perform-structure-i-e-sample-selection-with-fps-cur">
<h2>Perform structure (i.e. sample) selection with FPS/CUR<a class="headerlink" href="#perform-structure-i-e-sample-selection-with-fps-cur" title="Link to this heading">¶</a></h2>
<p>Instead of atomic environments, one can also select diverse structures. We can
use the <cite>sum_over_samples</cite> operation in metatensor to define features in the
structural basis instead of the atomic basis. This is done by summing over the
atomic environments, labeled by the ‘center’ index in the samples of the
TensorMap.</p>
<p>Alternatively, one could use the <cite>mean_over_samples</cite> operation, depending on
the specific inhomogeneity of the size of the structures in the training set.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----Structure selection-----&quot;</span><span class="p">)</span>

<span class="c1"># Define the number of structures to select *per block* using FPS</span>
<span class="n">n_structures</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># FPS structure selection</span>
<span class="n">selector_struct_fps</span> <span class="o">=</span> <span class="n">sample_selection</span><span class="o">.</span><span class="n">FPS</span><span class="p">(</span>
    <span class="n">n_to_select</span><span class="o">=</span><span class="n">n_structures</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="s2">&quot;random&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">struct_soap</span><span class="p">)</span>
<span class="n">struct_fps_idxs</span> <span class="o">=</span> <span class="n">selector_struct_fps</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;structures selected with FPS:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">struct_fps_idxs</span><span class="p">)</span>

<span class="c1"># CUR structure selection</span>
<span class="n">selector_struct_cur</span> <span class="o">=</span> <span class="n">sample_selection</span><span class="o">.</span><span class="n">CUR</span><span class="p">(</span><span class="n">n_to_select</span><span class="o">=</span><span class="n">n_structures</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">struct_soap</span><span class="p">)</span>
<span class="n">struct_cur_idxs</span> <span class="o">=</span> <span class="n">selector_struct_cur</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;structures selected with CUR:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">struct_cur_idxs</span><span class="p">)</span>


<span class="c1"># Slice structure descriptor along axis 0 to contain only the selected structures</span>
<span class="n">struct_soap_fps</span> <span class="o">=</span> <span class="n">struct_soap</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">struct_fps_idxs</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">struct_soap_cur</span> <span class="o">=</span> <span class="n">struct_soap</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">struct_cur_idxs</span><span class="p">,</span> <span class="p">:]</span>
<span class="k">assert</span> <span class="n">struct_soap_fps</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">struct_soap_cur</span><span class="o">.</span><span class="n">shape</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Structure descriptor shape before selection &quot;</span><span class="p">,</span> <span class="n">struct_soap</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Structure descriptor shape after selection (FPS)&quot;</span><span class="p">,</span> <span class="n">struct_soap_fps</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Structure descriptor shape after selection (CUR)&quot;</span><span class="p">,</span> <span class="n">struct_soap_cur</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>----Structure selection-----
structures selected with FPS:
 [ 15  71 140 167 172 257 317 326 356 496]
structures selected with CUR:
 [ 39  40  68 110 140 326 386 398 438 476]
Structure descriptor shape before selection  (500, 2688)
Structure descriptor shape after selection (FPS) (10, 2688)
Structure descriptor shape after selection (CUR) (10, 2688)
</pre></div>
</div>
</section>
<section id="visualize-selected-structures">
<h2>Visualize selected structures<a class="headerlink" href="#visualize-selected-structures" title="Link to this heading">¶</a></h2>
<p>sklearn can be used to perform PCA dimensionality reduction on the SOAP
descriptors. The resulting PC coordinates can be used to visualize the the
data alongside their structures in a chemiscope widget.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate a structure PCA</span>
<span class="n">struct_soap_pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">struct_soap</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">struct_soap_pca</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">n_frames</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<section id="plot-the-pca-map">
<h3>Plot the PCA map<a class="headerlink" href="#plot-the-pca-map" title="Link to this heading">¶</a></h3>
<p>Notice how the selected points avoid the densely-sampled area, and cover
the periphery of the dataset</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matplotlib plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">scatter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">struct_soap_pca</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">struct_soap_pca</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">struct_soap_pca</span><span class="p">[</span><span class="n">struct_cur_idxs</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">struct_soap_pca</span><span class="p">[</span><span class="n">struct_cur_idxs</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="s2">&quot;ko&quot;</span><span class="p">,</span>
    <span class="n">fillstyle</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;FPS selection&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;PCA[1]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;PCA[2]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_sample-selection_001.png" srcset="../../_images/sphx_glr_sample-selection_001.png" alt="sample selection" class = "sphx-glr-single-img"/></section>
<section id="creates-a-chemiscope-viewer">
<h3>Creates a chemiscope viewer<a class="headerlink" href="#creates-a-chemiscope-viewer" title="Link to this heading">¶</a></h3>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Selected level</span>
<span class="n">selection_levels</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)):</span>
    <span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">struct_cur_idxs</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">struct_fps_idxs</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">+=</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;Not selected&quot;</span>
    <span class="k">elif</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;CUR&quot;</span>
    <span class="k">elif</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;FPS&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;FPS+CUR&quot;</span>
    <span class="n">selection_levels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>

<span class="n">properties</span> <span class="o">=</span> <span class="n">chemiscope</span><span class="o">.</span><span class="n">extract_properties</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>

<span class="n">properties</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;PC1&quot;</span><span class="p">:</span> <span class="n">struct_soap_pca</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;PC2&quot;</span><span class="p">:</span> <span class="n">struct_soap_pca</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;selection&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">selection_levels</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">widget</span> <span class="o">=</span> <span class="n">chemiscope</span><span class="o">.</span><span class="n">show</span><span class="p">(</span>
    <span class="n">frames</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
    <span class="n">settings</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;PC1&quot;</span><span class="p">},</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;PC2&quot;</span><span class="p">},</span>
            <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;energy&quot;</span><span class="p">},</span>
            <span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="s2">&quot;selection&quot;</span><span class="p">,</span>
            <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;factor&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">},</span>
        <span class="p">},</span>
        <span class="s2">&quot;structure&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;unitCell&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}],</span>
    <span class="p">},</span>
<span class="p">)</span>
<span class="n">widget</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;sample-selection.json.gz&quot;</span><span class="p">)</span>

<span class="c1"># display, if in notebook or sphinx</span>
<span class="n">widget</span>
</pre></div>
</div>
<!-- begin headers -->
<!-- Load all dependencies -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>

<!-- JS scripts -->
<script src="../../_static/chemiscope.min.js"></script>
<script src="../../_static/chemiscope-sphinx.js"></script>

<!-- CSS styles -->
<link rel="stylesheet" href="../../_static/chemiscope-sphinx.css" type="text/css" />
<!-- end headers -->

<!-- Warning Display -->
<div id="chsp-1d72871c-988f-428b-8f0a-596a4bb8227d-warning-display" class="chemiscope-sphinx-warning">
    <p></p>
    <button type="button" aria-label="Close" onclick="hideElement('chsp-1d72871c-988f-428b-8f0a-596a4bb8227d-warning-display')">
        &times;
    </button>
</div>
<div style="padding: 0.5rem 1.25rem" />

<!-- Loading Spinner -->
<div id="chsp-1d72871c-988f-428b-8f0a-596a4bb8227d-loading" class="chemiscope-sphinx-spinner">
    <img src="../../_static/chemiscope-loading.svg" alt="Loading icon" />
</div>

<!-- Chemiscope Visualization -->
<div id="chsp-1d72871c-988f-428b-8f0a-596a4bb8227d">
    <!-- This will be replaced by the chemiscope HTML -->
</div>

<!-- Load Visualization Script -->
<script>
    loadChemiscopeSphinx('chsp-1d72871c-988f-428b-8f0a-596a4bb8227d', '../../_datasets/9244e8a7828e7fb72b9eb79a7fbd09a3139d8692c084ad611a00015c78b87a7d-fig_sample-selection_001.json.gz', 'default');
</script>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/home/runner/work/software-cookbook/software-cookbook/.nox/sample-selection/lib/python3.11/site-packages/chemiscope/structures/_ase.py:131: UserWarning: the following structure properties properties are only defined for a subset of frames: [&#39;stress&#39;]; they will be ignored
  all_names = _ase_list_structure_properties(frames)
/home/runner/work/software-cookbook/software-cookbook/.nox/sample-selection/lib/python3.11/site-packages/chemiscope/structures/__init__.py:78: UserWarning: the following structure properties properties are only defined for a subset of frames: [&#39;stress&#39;]; they will be ignored
  return _ase_list_structure_properties(frames)
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">

</div>
<br />
<br /></section>
</section>
<section id="perform-feature-selection">
<h2>Perform feature selection<a class="headerlink" href="#perform-feature-selection" title="Link to this heading">¶</a></h2>
<p>Now perform feature selection. In this example we will go back to using the
descriptor decomposed into atomic environments, as opposed to the one
decomposed into structure environments, but only use FPS for brevity.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----Feature selection-----&quot;</span><span class="p">)</span>

<span class="c1"># Define the number of features to select</span>
<span class="n">n_features</span> <span class="o">=</span> <span class="mi">200</span>

<span class="c1"># FPS feature selection</span>
<span class="n">feat_fps</span> <span class="o">=</span> <span class="n">feature_selection</span><span class="o">.</span><span class="n">FPS</span><span class="p">(</span><span class="n">n_to_select</span><span class="o">=</span><span class="n">n_features</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">atom_soap_single_block</span>
<span class="p">)</span>

<span class="c1"># Slice atomic descriptor along axis 1 to contain only the selected features</span>
<span class="c1"># atom_soap_single_block_fps = atom_soap_single_block.block(0).values[:, feat_fps_idxs]</span>
<span class="n">atom_soap_single_block_fps</span> <span class="o">=</span> <span class="n">metatensor</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span>
    <span class="n">atom_soap_single_block</span><span class="p">,</span>
    <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;properties&quot;</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">feat_fps</span><span class="o">.</span><span class="n">support</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;atomic descriptor shape before selection &quot;</span><span class="p">,</span>
    <span class="n">atom_soap_single_block</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;atomic descriptor shape after selection &quot;</span><span class="p">,</span>
    <span class="n">atom_soap_single_block_fps</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>----Feature selection-----
atomic descriptor shape before selection  (20000, 2688)
atomic descriptor shape after selection  (20000, 200)
</pre></div>
</div>
</section>
<section id="perform-feature-selection-skmatter">
<h2>Perform feature selection (skmatter)<a class="headerlink" href="#perform-feature-selection-skmatter" title="Link to this heading">¶</a></h2>
<p>Now perform feature selection. In this example we will go back to using the
descriptor decomposed into atomic environments, as opposed to the one
decomposed into structure environments, but only use FPS for brevity.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----Feature selection (skmatter)-----&quot;</span><span class="p">)</span>

<span class="c1"># Define the number of features to select</span>
<span class="n">n_features</span> <span class="o">=</span> <span class="mi">200</span>

<span class="c1"># FPS feature selection</span>
<span class="n">feat_fps</span> <span class="o">=</span> <span class="n">skfeat_selection</span><span class="o">.</span><span class="n">FPS</span><span class="p">(</span><span class="n">n_to_select</span><span class="o">=</span><span class="n">n_features</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">atom_soap_single_block</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="p">)</span>
<span class="n">feat_fps_idxs</span> <span class="o">=</span> <span class="n">feat_fps</span><span class="o">.</span><span class="n">selected_idx_</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Feature indices obtained with FPS &quot;</span><span class="p">,</span> <span class="n">feat_fps_idxs</span><span class="p">)</span>

<span class="c1"># Slice atomic descriptor along axis 1 to contain only the selected features</span>
<span class="n">atom_dscrptr_fps</span> <span class="o">=</span> <span class="n">atom_soap_single_block</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="n">feat_fps_idxs</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;atomic descriptor shape before selection &quot;</span><span class="p">,</span>
    <span class="n">atom_soap_single_block</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;atomic descriptor shape after selection &quot;</span><span class="p">,</span> <span class="n">atom_dscrptr_fps</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>----Feature selection (skmatter)-----
Feature indices obtained with FPS  [2607    0  920  464    3  411    1  488 1824  921    5  465   29 1179
   27 2240  468 1344    4 2244  602  923  489  274 1825   45  916 1180
   28 1308  475  470  731  924   46  283 1828  474  450   30  491 2241
  730  412 2084   12  477 1835 1636  859  476 1827 1796  496  413  931
  936   21  453 1345  899  466  939  940   11 1816 1324  934  900  948
  861  928 1490   19  860  925    2 1170 2276  456 1347 1819 1181 1310
   13  858 1380   36  210 1372 1812  926  929 2195  947  458 1196  451
 1307  492 2267  472 2212  915  462  449  733  725  922   18   37 2523
 2532 1365  932 1746  347  473  868  912  502  275  927 1362 2246 1172
  485   54  504  484  285  866  395   31  499 1348  480 1316 2092   38
 1805  901  913 1941  723  944 2213  898 1187 1939  941  402  907 1364
    6 1947  469 1309  467  490 1940   10  905  498 2242 1637  908  904
  452 2083  942 1820  937  724 1171  500  933  338  420 2524 1682 2254
  483 2221   22 1792 1764  494    7  738  949    9 2268 1832 1618 1323
  478  482  950  461]
atomic descriptor shape before selection  (20000, 2688)
atomic descriptor shape after selection  (20000, 200)
</pre></div>
</div>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-sample-selection-sample-selection-py">
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/328f2a3eeccb4e902f81e5646c33e2e8/environment.yml"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Conda</span> <span class="pre">environment</span> <span class="pre">file:</span> <span class="pre">environment.yml</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/54cb049367bea2b1604e2df18dc055b4/sample-selection.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">sample-selection.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/4dd8b470da0d1f3672e0a6f90c77c550/sample-selection.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">sample-selection.py</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../dos-align/dos-align.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Training the DOS with different Energy References</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../gaas-map/gaas-map.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">PCA/PCovR Visualization for the rattled GaAs training dataset</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; BSD 3-Clause License, Copyright (c) 2024, COSMO software cookbook team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Sample and Feature Selection with FPS and CUR</a><ul>
<li><a class="reference internal" href="#load-molecular-data">Load molecular data</a></li>
<li><a class="reference internal" href="#compute-soap-descriptors-using-rascaline">Compute SOAP descriptors using rascaline</a></li>
<li><a class="reference internal" href="#perform-atomic-environment-i-e-sample-selection">Perform atomic environment (i.e. sample) selection</a></li>
<li><a class="reference internal" href="#selecting-from-a-combined-pool-of-atomic-environments">Selecting from a combined pool of atomic environments</a></li>
<li><a class="reference internal" href="#perform-structure-i-e-sample-selection-with-fps-cur">Perform structure (i.e. sample) selection with FPS/CUR</a></li>
<li><a class="reference internal" href="#visualize-selected-structures">Visualize selected structures</a><ul>
<li><a class="reference internal" href="#plot-the-pca-map">Plot the PCA map</a></li>
<li><a class="reference internal" href="#creates-a-chemiscope-viewer">Creates a chemiscope viewer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#perform-feature-selection">Perform feature selection</a></li>
<li><a class="reference internal" href="#perform-feature-selection-skmatter">Perform feature selection (skmatter)</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=4e2eecee"></script>
    </body>
</html>